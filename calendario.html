<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Calend√°rio</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
/* Reset */
*{box-sizing:border-box;margin:0;padding:0}

/* Body */
body{
    background:#3f7c72ff;
    font-family:Roboto,Arial,sans-serif;
    color:#3f7c72ff;
    padding:40px;
    text-align:center;
}

/* Header */
h1{font-family:'SimpleHandmade',sans-serif;color:#fff;font-size:50px;margin-top:65px}

/* Calendar container */
.calendar{
    margin:30px auto;
    width:95%;
    max-width:900px;
    background:#bdebe3ff;
    border-radius:15px;
    padding:20px;
    box-shadow:0 4px 10px rgba(0,0,0,.2);
}

/* Month header */
.month{
    display:flex;
    justify-content:space-between;
    align-items:center;
    background:#2a5c55;
    color:#fff;
    padding:15px 20px;
    border-radius:10px;
    font-family:'SimpleHandmade',sans-serif;
    font-size:28px;
}
.month i{cursor:pointer;font-size:22px}

/* Weekdays row */
.weekdays{
    display:grid;
    grid-template-columns:repeat(7,1fr);
    gap:5px;
    margin:10px 0;
}
.weekdays div{
    font-family:'SimpleHandmade',sans-serif;
    color:#2a5c55;
    font-weight:bold;
    font-size:20px;
    padding:10px 0;
}

/* Days grid */
.days{
    display:grid;
    grid-template-columns:repeat(7,1fr);
    gap:5px;
    margin-top:10px;
}

/* Each day */
.day{
    padding:15px 0;
    background:#f1f6fb;
    border-radius:8px;
    cursor:pointer;
    font-family:'SimpleHandmade',sans-serif;
    transition:0.2s;
}
.day:hover{
    background:#96d2c7;
    color:#fff;
}
.today{
    background:#2a5c55;
    color:#fff;
    font-weight:bold;
}
.active{
    border:2px solid #1e3834ff;
}

/* Add event button */
.add-event{
    margin-top:25px;
    background:#2a5c55;
    color:#fff;
    padding:12px 25px;
    border-radius:10px;
    font-size:22px;
    border:none;
    cursor:pointer;
    font-family:'SimpleHandmade',sans-serif;
}
.add-event:hover{background:#1e3834ff}

/* Event list */
.event-list{
    margin-top:20px;
    text-align:left;
}
.event{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:10px;
    margin-bottom:8px;
    background:#bdebe3ff;
    border-radius:6px;
    font-size:16px;
}
.event button{
    background:transparent;
    border:none;
    color:#c00;
    cursor:pointer;
    opacity:0;
    transition:0.15s;
}
.event:hover button{opacity:1}

/* No event text */
.no-event{color:#777;font-style:italic;padding:10px}

/* Modal */
#modal{
    display:none;
    position:fixed;
    left:50%;
    top:50%;
    transform:translate(-50%,-50%);
    background:#fff;
    padding:18px;
    border-radius:14px;
    box-shadow:0 6px 24px rgba(0,0,0,.3);
    width:90%;
    max-width:420px;
    z-index:3000;
    text-align:left;
}
#modal input[type="text"], #modal input[type="time"]{
    width:100%;
    padding:10px;
    border-radius:8px;
    border:1px solid #2a5c55;
    margin:8px 0;
    font-size:16px;
}
#modal .btn{
    background:#2a5c55;
    color:#fff;
    padding:10px 18px;
    border-radius:10px;
    border:none;
    cursor:pointer;
}
#modal .btn-cancel{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:8px 16px;
    font-size:15px;
    font-weight:600;
    color:#2a5c55;
    background:linear-gradient(#f7fbf9,#ecf6f2);
    border:2px solid #2a5c55;
    border-radius:10px;
    cursor:pointer;
    transition: transform 150ms ease, box-shadow 150ms ease, background 150ms ease, color 150ms ease;
    box-shadow:0 2px 8px rgba(42,92,85,0.08);
    line-height:1;
}
#modal .btn-cancel:hover{
    background:#2a5c55;
    color:#fff;
    transform:translateY(-3px);
    box-shadow:0 8px 20px rgba(42,92,85,0.18);
}

/* Notifica√ß√£o estilo banner abaixo do header */
#notification {
    position: fixed;
    top: 80px; /* logo abaixo do header */
    left: 50%;
    transform: translateX(-50%);
    background: #2a5c55;
    color: #fff;
    padding: 15px 30px;
    border-radius: 10px;
    font-family: 'SimpleHandmade', sans-serif;
    font-size: 16px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s, transform 0.3s;
    z-index: 2000;
}
#notification.show {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
    pointer-events: auto;
}
    /* Barra toda */
::-webkit-scrollbar {
  width: 12px; /* largura da barra vertical */
  height: 12px; /* altura da barra horizontal */
}

/* Fundo da barra */
::-webkit-scrollbar-track {
  background: #f0f0f0; /* cor do fundo da barra */
  border-radius: 10px;
}

/* Parte que se move (thumb) */
::-webkit-scrollbar-thumb {
  background: #3f7c72; /* cor do "polegar" */
  border-radius: 10px;
  border: 3px solid #f0f0f0; /* d√° efeito de espa√ßamento */
}

/* Thumb ao passar o mouse */
::-webkit-scrollbar-thumb:hover {
  background: #2a5c55;
}
    /* Header */
header {
  position: fixed; top:0; left:0; width:100%; height:70px;
  background:#ffffffcc; display:flex; justify-content:space-between; align-items:center;
  padding:0 2rem; box-shadow:0 2px 5px rgba(0,0,0,0.1); z-index:1000;
}
    header .logo img{height:450px;width:auto;display:block; margin-left: -85px;}


    nav ul{list-style:none; display:flex; align-items:center; gap:20px; margin:0;}
nav ul li a{ text-decoration:none; color:black;  padding:5px 10px; border-radius:8px; transition:.3s;}

</style>
</head>
<body>
  <header>
    <div class="logo"><img src="/imagens/logoatual.png" alt="Logo"></div>
    <nav>
      <ul>
          <li><a href="/inicio.php">Voltar</a></li>
      </ul>
    </nav>
  </header>
<h1>Calend√°rio</h1>

<div class="calendar">
  <div class="month">
    <i class="fas fa-angle-left prev"></i>
    <div class="date"></div>
    <i class="fas fa-angle-right next"></i>
  </div>
  <div class="weekdays">
    <div>Dom</div><div>Seg</div><div>Ter</div><div>Qua</div><div>Qui</div><div>Sex</div><div>S√°b</div>
  </div>
  <div class="days"></div>
  <div class="event-list"></div>
</div>

<button class="add-event">+ Adicionar Evento</button>

<!-- Modal -->
<div id="modal">
    <h3>Adicionar Evento</h3>
    <input type="text" id="title" placeholder="T√≠tulo do evento">
    <input type="time" id="from"> at√© <input type="time" id="to"><br><br>
    <button class="btn" id="saveBtn">Salvar</button>
    <button class="btn-cancel" onclick="document.getElementById('modal').style.display='none'">Cancelar</button>
</div>

<!-- Notifica√ß√£o -->
<div id="notification"></div>

<script>
const dateEl = document.querySelector('.date');
const daysContainer = document.querySelector('.days');
const prevBtn = document.querySelector('.prev');
const nextBtn = document.querySelector('.next');
const eventsContainer = document.querySelector('.event-list');
const addBtn = document.querySelector('.add-event');

let today = new Date();
let month = today.getMonth();
let year = today.getFullYear();
let selectedDate = null;

const months = ["Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];

function renderCalendar(){
    const firstDay = new Date(year,month,1);
    const lastDay = new Date(year,month+1,0);
    const lastDate = lastDay.getDate();
    const startDayOfWeek = firstDay.getDay();

    dateEl.textContent = `${months[month]} ${year}`;

    let daysHTML = '';
    for(let i=0;i<startDayOfWeek;i++){daysHTML+='<div></div>'}
    for(let i=1;i<=lastDate;i++){
        daysHTML+=`<div class="day">${i}</div>`;
    }
    daysContainer.innerHTML = daysHTML;

    document.querySelectorAll('.day').forEach(div=>{
        const dayNum = Number(div.textContent);
        if(dayNum===today.getDate() && month===today.getMonth() && year===today.getFullYear()){
            div.classList.add('today');
        }
        div.onclick = ()=>{
            selectedDate = `${year}-${String(month+1).padStart(2,'0')}-${String(dayNum).padStart(2,'0')}`;
            document.getElementById('modal').style.display='block';
            loadEvents();
            document.querySelectorAll('.day').forEach(d=>d.classList.remove('active'));
            div.classList.add('active');
        };
    });
}

prevBtn.onclick = ()=>{
    month--;
    if(month<0){month=11;year--;}
    renderCalendar();
};
nextBtn.onclick = ()=>{
    month++;
    if(month>11){month=0;year++;}
    renderCalendar();
};

addBtn.onclick = ()=>{
    if(!selectedDate) return showNotification('‚ö†Ô∏è Selecione um dia primeiro!');
    document.getElementById('modal').style.display='block';
};

async function loadEvents(){
    const res = await fetch('buscar_eventos.php');
    const data = await res.json();
    const html = data.filter(ev=>ev.data_evento===selectedDate)
        .map(ev=>`<div class="event">${ev.hora_inicio} - ${ev.hora_fim} | ${ev.titulo} <button onclick="deleteEvent(${ev.id})">üóëÔ∏è</button></div>`).join('');
    eventsContainer.innerHTML = html || '<div class="no-event">Nenhum evento neste dia.</div>';
}

function showNotification(msg){
    const notif = document.getElementById('notification');
    notif.textContent = msg;
    notif.classList.add('show');
    setTimeout(()=>notif.classList.remove('show'),3000);
}

document.getElementById('saveBtn').onclick = async ()=>{
    const title = document.getElementById('title').value.trim();
    const from = document.getElementById('from').value.trim();
    const to = document.getElementById('to').value.trim();
    if(!title||!from||!to) return showNotification('‚ö†Ô∏è Preencha todos os campos!');
    const form = new FormData();
    form.append('titulo', title);
    form.append('data_evento', selectedDate);
    form.append('hora_inicio', from);
    form.append('hora_fim', to);

    try{
        const res = await fetch('salvar_evento.php',{method:'POST',body:form});
        const text = await res.text();
        if(text.trim()=='ok'){
            document.getElementById('modal').style.display='none';
            document.getElementById('title').value='';
            document.getElementById('from').value='';
            document.getElementById('to').value='';
            loadEvents();
            showNotification('üéâ Evento salvo com sucesso!');
        }else{
            showNotification('‚ö†Ô∏è Erro ao salvar evento!');
        }
    }catch(e){
        showNotification('‚ö†Ô∏è Erro ao salvar evento!');
        console.error(e);
    }
};

async function deleteEvent(id){
    const form = new FormData();
    form.append('id',id);
    try{
        const res = await fetch('excluir_evento.php',{method:'POST',body:form});
        const text = await res.text();
        if(text.trim()=='ok'){
            loadEvents();
            showNotification('üóëÔ∏è Evento exclu√≠do!');
        }else{
            showNotification('‚ö†Ô∏è Erro ao excluir evento!');
        }
    }catch(e){
        showNotification('‚ö†Ô∏è Erro ao excluir evento!');
        console.error(e);
    }
}

// Inicializa
renderCalendar();
</script>

</body>
</html>
